{% if series_info %}
<div class='series-info'>
    series info
</div>
{% endif %}
<div class='episode-list'>
    <table>
        <thead>
        <tr>
            <td>Episode</td>
            <td>Title</td>
            <td>Online</td>
            <td>Languages</td>
            <td>Release date</td>
            <td>Show players</td>
        </tr>
        </thead>
        <tbody>
        {% for episode in episode_list %}
        <tr>
            <td>{{ episode['episode'] }}</td>
            <td>{{ episode['title'] }}</td>
            <td>{{ episode['online'] }}</td>
            <td>{{ episode['langs'] }}</td>
            <td>{{ episode['release_date'] }}</td>
            <td>
                <a href={{ episode['url'] }}><button>Show</button></a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <table>
    </table>
</div>
{% if player_list %}
<div class='player-list'>
    <div>
        Episode {{ player_list[0]['episode_number'] }}
    </div>
    <div id='iframe'></div>
    <div>
        <table>
            <thead>
            <tr>
                <th>Player</th>
                <th>Subs authors</th>
                <th>Resolution</th>
                <th>Audio</th>
                <th>Subs</th>
                <th>Added</th>
                <th>Watch</th>
            </tr>
            </thead>
            <tbody>
            {% for player in player_list %}
                <tr>
                    <td>{{ player['player'] }}</td>
                    <td>
                        {% if player['subs-fav-icon-url'] %}
                            <img src="{{ player['subs-fav-icon-url'] }}" height="20" width="20" alt="">
                        {% endif %}
                        {{ player['subs-authors'] }}
                    </td>
                    <td>{{ player['max_res'] }}</td>
                    <td>{{ player['lang_audio'] }}</td>
                    <td>{{ player['lang_subs'] }}</td>
                    <td>{{ player['added'] }}</td>
                    <td><button id='{{ player['online_id'] }}' onclick='request_player(this.id)'>Show</button></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    let iframe = document.getElementById('iframe')
    function show_player(iframe_data){
        iframe.innerHTML = iframe_data
        console.log(iframe_data)
    }

    function request_player(player_id) {
        iframe.innerHTML = '<div class="player-box loading-player">Loading</div>'

        let xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState === 4){
                if (xmlHttp.status === 200){
                    show_player(xmlHttp.responseText);
                }
                else {
                    iframe.innerHTML = '<div class="player-box error">An unexpected error occured</div>';
                }
            }
        }
        xmlHttp.open("GET", location.origin + '/player/' + player_id, true);
        xmlHttp.send(null);
    }
</script>
{% endif %}